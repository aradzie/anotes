{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Anki Notes",
  "scopeName": "source.anki-notes",
  "patterns": [
    {
      "include": "#keywords"
    },
    {
      "include": "#cloze"
    },
    {
      "include": "#latex"
    }
  ],
  "repository": {
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.anki-notes",
          "match": "(?i)^!(type|deck|tags):"
        },
        {
          "name": "keyword.anki-notes",
          "match": "^![-_a-zA-Z0-9]+([ \t]+[-_a-zA-Z0-9]+)*:"
        },
        {
          "name": "keyword.anki-notes",
          "match": "^~~~[ \t]*$"
        }
      ]
    },
    "cloze": {
      "name": "string.other.anki-lang",
      "begin": "\\{\\{(c[1-9])::",
      "end": "\\}\\}|(?=^![-_a-zA-Z0-9]+([ \t]+[-_a-zA-Z0-9]+)*:)|(?=^~~~[ \t]*$)",
      "patterns": [{ "include": "#cloze" }]
    },
    "latex": {
      "patterns": [
        {
          "name": "string.other.anki-lang",
          "begin": "\\\\\\[",
          "end": "\\\\\\]|(?=^![-_a-zA-Z0-9]+([ \t]+[-_a-zA-Z0-9]+)*:)|(?=^~~~[ \t]*$)",
          "patterns": [
            {
              "include": "#inner-latex"
            }
          ]
        },
        {
          "name": "string.other.anki-lang",
          "begin": "\\\\\\(",
          "end": "\\\\\\)|(?=^![-_a-zA-Z0-9]+([ \t]+[-_a-zA-Z0-9]+)*:)|(?=^~~~[ \t]*$)",
          "patterns": [
            {
              "include": "#inner-latex"
            }
          ]
        },
        {
          "name": "string.other.anki-lang",
          "begin": "(?<!\\\\)\\$\\$(?!\\$)",
          "end": "\\$\\$|(?=^![-_a-zA-Z0-9]+([ \t]+[-_a-zA-Z0-9]+)*:)|(?=^~~~[ \t]*$)",
          "patterns": [
            {
              "include": "#inner-latex"
            }
          ]
        },
        {
          "name": "string.other.anki-lang",
          "begin": "(?<!\\\\)\\$(?!\\$)",
          "end": "\\$|(?=^![-_a-zA-Z0-9]+([ \t]+[-_a-zA-Z0-9]+)*:)|(?=^~~~[ \t]*$)",
          "patterns": [
            {
              "include": "#inner-latex"
            }
          ]
        }
      ]
    },
    "inner-latex": {
      "patterns": [
        {
          "name": "entity.name.function.anki-notes",
          "match": "(?<!\\\\)\\\\(begin|end)\\s*\\{[a-zA-Z]+\\*?\\}"
        },
        {
          "name": "entity.name.function.anki-notes",
          "match": "(?<!\\\\)\\\\[a-zA-Z]+"
        },
        {
          "match": "([0-9]*\\.[0-9]+)|[0-9]+",
          "name": "constant.numeric.anki-notes"
        },
        {
          "match": "[a-zA-Z]+",
          "name": "variable.other.anki-notes"
        }
      ]
    }
  }
}
